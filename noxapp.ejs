<% for(var model in models) { %>
var <%= model %>Model = Backbone.Model.extend({
  __model_name : '<%= model %>',
  __fields : [<% for(var i in models[model].__fields) {%>'<%= models[model].__fields[i] %>',<%} %>],
});

var <%= model %>Collection = Backbone.Collection.extend({
  __name : '<%= model %>s',
  __model_name : '<%= model %>',
  __model: <%= model %>Model,
  __list_display: [<% for(var i in models[model].__list_display) {%>'<%= models[model].__list_display[i] %>',<%} %>]
});<% } %>
<% for(var model in models) { %>
var <%=: model | downcase %>Collection = new <%= model %>Collection();<% } %>

var ModelView = Backbone.View.extend({
  el: "#content",
  initialize: function(){
  },
  link : function(model){
    this.model = model;
  },
  render: function(id){
    $(this.el).html(require('ejs').render($('#edit_view').html(), { model:this.model  }));
    //Backbone.ModelBinding.bind(this);
  }
});
var modelView = new ModelView();

var CollectionView = Backbone.View.extend({
  el: "#content",
  initialize: function(){
  },
  link : function(collection){
    this.collection = collection;
  },
  render: function(){
    $(this.el).html(require('ejs').render($('#list_view').html(), { headings:this.collection.__list_display,items:this.collection.models,model_name:this.collection.__model_name  }));
  }
});
var collectionView = new CollectionView();

authorCollection.add(new AuthorModel({id:0,name:'Edgar Alan',surname:'Poe'}));
authorCollection.add(new AuthorModel({id:1,name:'Ernest',surname:'Hemingway'}));


var Router = Backbone.Router.extend({
  routes: {
    <% for(var model in models) { %>
    '/<%= model %>/:id'         : 'edit<%= model %>',
    '/<%= model %>s'            : 'view<%= model %>s',
    '/<%= model %>s/Delete/:id' : 'delete<%= model %>s',<% } %>
    '*actions': 'defaultAction'
  },
  <% for(var model in models) { %>
  edit<%= model %> : function(id){
    //alert('<%= model %> - '+id);  
    modelView.link(<%=: model | downcase %>Collection.get(id));
    modelView.render(id);
  },
  view<%= model %>s : function(){
    //alert('<%= model %>s'); 
    collectionView.link(<%=: model | downcase %>Collection);
    collectionView.render();  
  },
  delete<%= model %>s : function(id){
    <%=: model | downcase %>Collection.remove(<%=: model | downcase %>Collection.get(id));
    this.view<%= model %>s();
  },<% } %>
  defaultAction: function(actions){
    alert('No route: ' + [actions,'hallo']);  
    console.log('No route:', [actions,'hallo']);
  }
});

var router = new Router();
Backbone.history.start();

