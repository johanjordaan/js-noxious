<% for(var model_key in models) { %>
<% var model = models[model_key] %>
var <%= model_key %>Meta = {
  fields : [<% for(var i in model.__meta.fields) {%>'<%= model.__meta.fields[i] %>',<%} %>],
  list_fields : [<% for(var i in model.__meta.list_fields) {%>'<%= model.__meta.list_fields[i] %>',<%} %>],
<% for(var i in model.__meta.fields) { -%>
<% var field_name = model.__meta.fields[i]; var field = model[field_name]; -%>
  <%= field_name %> : <%- field.js_new_code() %>,
<% } %>}

var <%= model_key %>Model = Backbone.Model.extend({                                   
  __meta : <%= model_key %>Meta,
});

var <%= model_key %>Collection =  Backbone.Collection.extend({                                   
  model :  <%= model_key %>,
});
<% } %>

var ModelView = Backbone.View.extend({
  el: "#content",
  initialize: function(){
  },
  render : function(model) {
    this.model = model;
    $(this.el).html(require('ejs').render($('#form_view_template').html(), { model:this.model }));
    Backbone.ModelBinding.bind(this);
  },  
});
var modelView = new ModelView();

var CollectionView = Backbone.View.extend({
  el: "#content",
  initialize: function(){
  },
  link : function(collection){
    this.collection = collection;
  },
  render: function(c) {
    this.collection = c;
    $(this.el).html(require('ejs').render($('#list_view_template').html(), { __meta:model.__meta, models:this.collection.models }));
  },
});
var collectionView = new CollectionView();

authorCollection.add(new AuthorModel({id:0,name:'Edgar Alan',surname:'Poe'}));
authorCollection.add(new AuthorModel({id:1,name:'Ernest',surname:'Hemingway'}));


var Router = Backbone.Router.extend({
  routes: {
    <% for(var model in models) { %>
    '/<%= model %>/:id'         : 'edit<%= model %>',
    '/<%= model %>s'            : 'view<%= model %>s',
    '/<%= model %>s/Delete/:id' : 'delete<%= model %>s',<% } %>
    '*actions': 'defaultAction'
  },
  <% for(var model in models) { %>
  edit<%= model %> : function(id){
    modelView.render(<%=: model | downcase %>Collection.get(id));
  },
  view<%= model %>s : function(){
    collectionView.render(<%=: model | downcase %>Collection);  
  },
  delete<%= model %>s : function(id){
    <%=: model | downcase %>Collection.remove(<%=: model | downcase %>Collection.get(id));
    this.view<%= model %>s();
  },<% } %>
  defaultAction: function(actions){
    alert('No route: ' + [actions,'hallo']);  
    console.log('No route:', [actions,'hallo']);
  }
});

var router = new Router();
Backbone.history.start();

